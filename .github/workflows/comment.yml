name: PR Comment Workflow

on:
  # pull_request_review_comment:
  #   types: [created]
  
  issue_comment:
    types: [created]

jobs:
  comment_checker:
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
    - uses: actions/checkout@v2
      with:
        token: ${{ github.token }}

    - name: Setup Python
      uses: actions/setup-python@v2.2.2
      with:
        python-version: 3.8
    # - name: Check event type
    #   run: |
    #     echo "Event type: ${{ github.event_name }}"
    - name: Get pull request number
      run: |
        echo "Event type: ${{ github.event_name }}"
        echo $env
        env
        echo "${{github.event.number }}"
        echo "${{github.event.issue.number}}"
        echo github.event.pull_request.number = ${{ github.event.pull_request.number }}
        if [[ "${{ github.event_name }}" == "issue_comment" ]]; then
          pr_number=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.issue.number }} | \
          jq -r '.pull_request.number')
          echo "PR Number: ${pr_number}"
        fi

    - name: Execute Python Script
      env: 
        GIT_TOKEN: ${{ github.token }}
        GITHUB_EVENT_PULL_REQUEST_NUMBER: "${{github.event.issue.number}}"
      run: |
        echo "Checking comment body"
        echo github.event.comment.body: ${{ github.event.comment.body }}
        if echo "${{ github.event.comment.body }}" | grep -q -E '^atlantis plan'; then
          echo "Comment contains atlantis plan"
          echo pwd : $PWD
          pip3 install requests
          python3 ./.github/actions/sample2.py
        else
          echo "Comment doesnot contains atlantis plan in it"
        fi
        
################
 